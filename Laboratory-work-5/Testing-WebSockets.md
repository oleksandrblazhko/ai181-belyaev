# Тестування WebSockets

## Загальне

Традиційно протокол HTTP дозволяє лише один запит/відповідь на TCP-з’єднання. Асинхронні JavaScript і XML (AJAX) дозволяють клієнтам асинхронно надсилати й отримувати дані (у фоновому режимі без оновлення сторінки) на сервер, однак AJAX вимагає від клієнта ініціювати запити та чекати відповідей сервера (напівдуплекс).
WebSockets дозволяють клієнту або серверу створювати «повнодуплексний» (двосторонній) канал зв’язку, дозволяючи клієнту та серверу дійсно спілкуватися асинхронно. WebSockets здійснюють своє початкове рукостискання оновлення через HTTP, і відтоді весь зв’язок здійснюється через канали TCP за допомогою фреймів. Щоб дізнатися більше, перегляньте протокол WebSockets.

### Джерело
Сервер відповідає за перевірку заголовка Джерело у початковому рукостисканні HTTP WebSockets. Якщо сервер не перевіряє заголовок джерела під час початкового рукостискання WebSockets, сервер WebSocket може приймати підключення з будь-якого джерела. Це може дозволити зловмисникам обмінюватися даними з міждоменним сервером WebSocket, дозволяючи виникати проблеми, подібні до CSRF. Дивіться також Top 10-2017 A5-Порушений контроль доступу.

### Конфіденційність і цілісність 
WebSockets можна використовувати через незашифрований TCP або через зашифрований TLS. Для використання незашифрованих WebSockets використовується схема ws:// URI (порт за замовчуванням 80), для використання зашифрованих (TLS) WebSockets використовується схема wss:// URI (порт за замовчуванням 443). Дивіться також Топ 10-2017 A3-Розкриття конфіденційних даних.

### Обробка входу
Як і будь-які дані, отримані з ненадійних джерел, дані мають бути належним чином оброблені та закодовані. Дивіться також Top 10-2017 A1-Ін'єкція і Top 10-2017 A7-Міжсайтовий сценарій (XSS).

## Цілі тестування

- Визначити використання WebSockets.
- Оцінити його реалізацію, використовуючи ті самі тести на звичайних каналах HTTP.

## Як тестувати

### Тестувати як чорний ящик
1. Визначте, що програма використовує WebSockets.
- Перевірте вихідний код клієнта на наявність схеми URI ws:// або wss://.
- Використовуйте Інструменти розробника Google Chrome, щоб переглянути зв’язок мережі WebSockets.
- Використовуйте вкладку WebSocket ZAP.
2. Джерело.
- За допомогою клієнта WebSocket (його можна знайти в розділі «Інструменти» нижче) спробуйте підключитися до віддаленого сервера WebSocket. Якщо з’єднання встановлено, сервер може не перевіряти вихідний заголовок рукостискання WebSocket.
3. Конфіденційність і цілісність.
- Переконайтеся, що підключення WebSocket використовує SSL для передачі конфіденційної інформації wss://.
- Перевірте впровадження SSL на наявність проблем із безпекою (дійсний сертифікат, BEAST, CRIME, RC4 тощо). Див. розділ «Тестування слабкої безпеки транспортного рівня» цього посібника.
4. Аутентифікація.
- WebSockets не обробляють автентифікацію, слід проводити звичайні тести автентифікації чорної скриньки. Зверніться до розділів Тестування автентифікації цього посібника.
5. Авторизація.
- WebSockets не обробляють авторизацію, слід провести звичайні тести авторизації чорної скриньки. Зверніться до розділів Тестування авторизації цього посібника.
6. Обробка входу.
- Використовуйте вкладку WebSocket у ZAP, щоб відтворювати та змішувати запити та відповіді WebSocket. Зверніться до розділів Тестування для перевірки даних цього посібника.

#### Приклад 1
Коли ми визначили, що програма використовує WebSockets (як описано вище), ми можемо використовувати OWASP Zed Attack Proxy (ZAP) для перехоплення запиту WebSocket і відповідей. Після цього ZAP можна використовувати для відтворення та розмитості запитів/відповідей WebSocket.
![image](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/11-Client-side_Testing/images/OWASP_ZAP_WebSockets.png)
Рисунок 4.11.10-1: ZAP WebSockets

#### Приклад 2
За допомогою клієнта WebSocket (його можна знайти в розділі «Інструменти» нижче) спробуйте підключитися до віддаленого сервера WebSocket. Якщо підключення дозволено, сервер WebSocket може не перевіряти вихідний заголовок рукостискання WebSocket. Спробуйте відтворити раніше перехоплені запити, щоб перевірити, чи можливе міждоменне спілкування WebSocket.
![image](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/11-Client-side_Testing/images/WebSocket_Client.png)
Рисунок 4.11.10-2: Клієнт WebSocket

### Тестувати як сірий ящик
Тестування сірого ящика схоже на тестування чорного ящика. У тестуванні сірого ящика тестувальник пера частково знає програму. Єдина відмінність тут полягає в тому, що ви можете мати документацію API для програми, що тестується, яка містить очікуваний запит WebSocket і відповіді.
